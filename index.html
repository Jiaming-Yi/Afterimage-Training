<!DOCTYPE html>
<!-- æ›´æ–°æ—¶é—´: 2025-01-27 -->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ®‹åƒè®­ç»ƒç¨‹åº - å³è„‘å¼€å‘åŸºç¡€è®­ç»ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .training-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 800px;
            width: 100%;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: #667eea;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mode-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: #4c51bf;
            box-shadow: 0 4px 15px rgba(76, 81, 191, 0.4);
        }

        .training-area {
            text-align: center;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 20px;
            position: relative;
        }

        .training-card {
            width: 200px;
            height: 200px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .training-card:hover {
            transform: scale(1.05);
        }

        /* è®­ç»ƒæ—¶å¡«æ»¡æ•´ä¸ªè®­ç»ƒåŒºåŸŸ */
        .training-card.training-active {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            margin: 0;
            z-index: 10;
        }
        
        .training-card.training-active.yellow-card::after {
            width: 8vmin;
            height: 8vmin;
        }

        /* é»„å¡æ ·å¼ */
        .yellow-card {
            background: #ffff00;
            position: relative;
        }

        .yellow-card::after {
            content: '';
            width: 40px;
            height: 40px;
            background: #0606f2;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* ç™½è‰²èƒŒæ™¯ */
        .white-background {
            background: white;
            border: 2px solid #ccc;
        }

        /* å½©è™¹é¢œè‰²å¡ç‰‡ */
        .color-red { background: #FF0000; }
        .color-orange { background: #FFA500; }
        .color-yellow { background: #FFFF00; }
        .color-green { background: #00FF00; }
        .color-cyan { background: #00FFFF; }
        .color-blue { background: #0000FF; }
        .color-purple { background: #800080; }

        /* å½¢çŠ¶å¡ç‰‡ */
        .shape-card {
            background: white;
            border: 3px solid #333;
        }

        .circle {
            width: 80px;
            height: 80px;
            border: 4px solid #000;
            border-radius: 50%;
            background: transparent;
        }

        .triangle {
            width: 0;
            height: 0;
            border-left: 40px solid transparent;
            border-right: 40px solid transparent;
            border-bottom: 70px solid #000;
        }

        .diamond {
            width: 60px;
            height: 60px;
            background: transparent;
            border: 4px solid #000;
            transform: rotate(45deg);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .start-btn {
            background: #667eea;
            color: white;
        }

        .start-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .stop-btn {
            background: #6c757d;
            color: white;
        }

        .stop-btn:hover {
            background: #5a6268;
        }

        .switch-btn {
            background: #667eea;
            color: white;
        }

        .switch-btn:hover {
            background: #5a6fd8;
        }

        .next-btn {
            background: #667eea;
            color: white;
        }

        .next-btn:hover {
            background: #5a6fd8;
        }

        .log-btn {
            background: #805ad5;
            color: white;
        }

        .log-btn:hover {
            background: #6b46c1;
        }

        .timer {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .instructions {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .instructions li {
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .instructions li:last-child {
            border-bottom: none;
        }

        .color-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .shape-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .shape-option {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .shape-option:hover {
            border-color: #667eea;
        }

        .shape-option.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.1s ease;
        }

        .training-settings {
            text-align: center;
            margin: 20px 0;
        }

        .training-settings label {
            font-weight: bold;
            color: #4a5568;
            margin-right: 10px;
        }

        .training-settings input {
            width: 80px;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 1em;
        }

        .training-stats {
            display: flex;
            justify-content: space-around;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #e2e8f0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            display: block;
            font-size: 14px;
            color: #718096;
            margin-bottom: 5px;
        }

        .stat-value {
            display: block;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .log-entry {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .log-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .log-details {
            color: #718096;
            font-size: 14px;
        }

        .clear-log-btn {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .clear-log-btn:hover {
            background: #5a6268;
        }

        .pomodoro-timer {
            background: #f0f2f5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .pomodoro-timer h3 {
            color: #dd6b20;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .pomodoro-display {
            font-size: 3em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .pomodoro-display .pomodoro-status {
            display: block;
            font-size: 0.4em;
            font-weight: normal;
            color: #718096;
            margin-bottom: 5px;
        }

        .pomodoro-display .pomodoro-status.break-mode {
            color: #38a169;
        }

        .pomodoro-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        #pomodoroStartPause {
            background-color: #38a169;
        }
        #pomodoroStartPause:hover {
            background-color: #2f855a;
        }
        
        #pomodoroReset {
            background-color: #718096;
        }
        #pomodoroReset:hover {
            background-color: #4a5568;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .training-container {
                padding: 20px;
            }
            
            .training-card {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§  æ®‹åƒè®­ç»ƒç¨‹åº</h1>
        <p>å³è„‘å¼€å‘åŸºç¡€è®­ç»ƒ - æå‡ç…§ç›¸è®°å¿†èƒ½åŠ›</p>
    </div>

    <div class="training-container">
        <!-- è®­ç»ƒæ¨¡å¼é€‰æ‹© -->
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="yellow">é»„å¡è®­ç»ƒ</button>
            <button class="mode-btn" data-mode="color">å½©è™¹é¢œè‰²è®­ç»ƒ</button>
            <button class="mode-btn" data-mode="shape">å½¢çŠ¶è®­ç»ƒ</button>
        </div>

        <!-- ç•ªèŒ„é’Ÿ -->
        <div class="pomodoro-timer">
            <h3>ğŸ… ç•ªèŒ„é’Ÿ</h3>
            <div class="pomodoro-display">
                <span id="pomodoroStatus" class="pomodoro-status">ä¸“æ³¨</span>
                <span id="pomodoroTime">25:00</span>
            </div>
            <div class="pomodoro-controls">
                <button class="control-btn" id="pomodoroStartPause">å¼€å§‹</button>
                <button class="control-btn" id="pomodoroReset">é‡ç½®</button>
            </div>
        </div>

        <!-- è®­ç»ƒåŒºåŸŸ -->
        <div class="training-area" id="trainingArea">
            <div class="training-card yellow-card" id="trainingCard"></div>
        </div>

        <!-- è®¡æ—¶å™¨ -->
        <div class="timer" id="timer">å‡†å¤‡å¼€å§‹è®­ç»ƒ</div>

        <!-- è®­ç»ƒè®¾ç½® -->
        <div class="training-settings">
            <label for="durationSetting">æ¯é˜¶æ®µæ—¶é•¿(ç§’):</label>
            <input type="number" id="durationSetting" value="30" min="5" max="300" step="5">
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button class="control-btn start-btn" id="startBtn">å¼€å§‹è®­ç»ƒ</button>
            <button class="control-btn switch-btn" id="switchBtn" disabled>åˆ‡æ¢åˆ°ç™½çº¸</button>
            <button class="control-btn stop-btn" id="stopBtn" disabled>åœæ­¢è®­ç»ƒ</button>
            <button class="control-btn next-btn" id="nextBtn" style="display: none;">ä¸‹ä¸€ä¸ª</button>
            <button class="control-btn log-btn" id="logBtn">æŸ¥çœ‹è®­ç»ƒæ—¥å¿—</button>
        </div>

        <!-- è®­ç»ƒç»Ÿè®¡ -->
        <div class="training-stats" id="trainingStats">
            <div class="stat-item">
                <span class="stat-label">å½“å‰è½®æ¬¡:</span>
                <span class="stat-value" id="currentRound">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æœ¬æ¬¡è®­ç»ƒæ—¶é—´:</span>
                <span class="stat-value" id="sessionTime">0åˆ†0ç§’</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ç´¯è®¡è®­ç»ƒæ—¶é—´:</span>
                <span class="stat-value" id="totalTime">0åˆ†é’Ÿ</span>
            </div>
        </div>

        <!-- å½©è™¹é¢œè‰²é€‰æ‹©å™¨ -->
        <div class="color-selector" id="colorSelector" style="display: none;">
            <div class="color-option color-red" data-color="red"></div>
            <div class="color-option color-orange" data-color="orange"></div>
            <div class="color-option color-yellow" data-color="yellow"></div>
            <div class="color-option color-green" data-color="green"></div>
            <div class="color-option color-cyan" data-color="cyan"></div>
            <div class="color-option color-blue" data-color="blue"></div>
            <div class="color-option color-purple" data-color="purple"></div>
        </div>

        <!-- å½¢çŠ¶é€‰æ‹©å™¨ -->
        <div class="shape-selector" id="shapeSelector" style="display: none;">
            <div class="shape-option active" data-shape="circle">åœ†å½¢ â—‹</div>
            <div class="shape-option" data-shape="triangle">ä¸‰è§’å½¢ â–³</div>
            <div class="shape-option" data-shape="diamond">è±å½¢ â—‡</div>
        </div>

        <!-- è®­ç»ƒè¯´æ˜ -->
        <div class="instructions" id="instructions">
            <h3>ğŸ¯ é»„å¡è®­ç»ƒè¯´æ˜</h3>
            <ul>
                <li>1. åœ¨ä¸Šæ–¹è®¾ç½®å¥½æ¯é˜¶æ®µæ—¶é•¿åï¼Œç‚¹å‡»"å¼€å§‹è®­ç»ƒ"æŒ‰é’®</li>
                <li>2. æ¯è½®è®­ç»ƒï¼šå‡è§†é»„å¡ã€è®¾å®šæ—¶é•¿ã€‘ â†’ è‡ªåŠ¨åˆ‡æ¢ç™½çº¸ã€è®¾å®šæ—¶é•¿ã€‘ â†’ è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®</li>
                <li>3. è®­ç»ƒè¿‡ç¨‹ä¸­å°½é‡ä¸è¦çœ¨çœ¼ï¼Œä¿æŒæ³¨æ„åŠ›é›†ä¸­</li>
                <li>4. åˆæœŸçœ‹åˆ°çš„æ®‹åƒæ˜¯è¡¥è‰²ï¼ˆè“åº•é»„ç‚¹ï¼‰ï¼Œéšç€è®­ç»ƒè¿›æ­¥ä¼šçœ‹åˆ°åŸè‰²</li>
                <li>5. ç¨‹åºä¼šè‡ªåŠ¨è®°å½•è®­ç»ƒæ—¶é—´å’Œè½®æ¬¡ï¼Œå¯ç‚¹å‡»"åœæ­¢è®­ç»ƒ"ç»“æŸå¹¶ä¿å­˜è®°å½•</li>
            </ul>
        </div>
    </div>

    <!-- è®­ç»ƒæ—¥å¿—æ¨¡æ€æ¡† -->
    <div id="logModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“Š è®­ç»ƒæ—¥å¿—</h2>
                <span class="close" id="closeModal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <button class="clear-log-btn" id="clearLogBtn">æ¸…ç©ºæ—¥å¿—</button>
                </div>
                <div id="logContent">
                    <p style="text-align: center; color: #718096;">æš‚æ— è®­ç»ƒè®°å½•</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AfterimageTrainer {
            constructor() {
                this.currentMode = 'yellow';
                this.isTraining = false;
                this.timer = null;
                this.timeLeft = 0;
                this.totalTime = 30;
                this.currentColorIndex = 0;
                this.currentShape = 'circle';
                this.colors = ['red', 'orange', 'yellow', 'green', 'cyan', 'blue', 'purple'];
                this.colorNames = {
                    'red': 'çº¢è‰²', 'orange': 'æ©™è‰²', 'yellow': 'é»„è‰²', 
                    'green': 'ç»¿è‰²', 'cyan': 'é’è‰²', 'blue': 'è“è‰²', 'purple': 'ç´«è‰²'
                };
                
                // è®­ç»ƒç»Ÿè®¡ç›¸å…³
                this.currentRound = 0;
                this.sessionStartTime = null;
                this.sessionTime = 0;
                this.autoTraining = false;
                this.sessionTimer = null;
                
                this.initializeElements();
                this.bindEvents();
                this.updateInstructions();
                this.loadTrainingStats();
                this.startSessionTimer();
            }

            initializeElements() {
                this.timerDisplay = document.getElementById('timer');
                this.progressFill = document.getElementById('progressFill');
                this.trainingArea = document.getElementById('trainingArea');
                this.trainingCard = document.getElementById('trainingCard');
                this.startBtn = document.getElementById('startBtn');
                this.switchBtn = document.getElementById('switchBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.logBtn = document.getElementById('logBtn');
                this.colorSelector = document.getElementById('colorSelector');
                this.shapeSelector = document.getElementById('shapeSelector');
                this.instructions = document.getElementById('instructions');
                this.durationInput = document.getElementById('durationSetting');
                
                // ç»Ÿè®¡æ˜¾ç¤ºå…ƒç´ 
                this.currentRoundDisplay = document.getElementById('currentRound');
                this.sessionTimeDisplay = document.getElementById('sessionTime');
                this.totalTimeDisplay = document.getElementById('totalTime');
                
                // æ¨¡æ€æ¡†å…ƒç´ 
                this.logModal = document.getElementById('logModal');
                this.closeModal = document.getElementById('closeModal');
                this.clearLogBtn = document.getElementById('clearLogBtn');
                this.logContent = document.getElementById('logContent');
            }

            bindEvents() {
                // æ¨¡å¼é€‰æ‹©æŒ‰é’®
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentMode = e.target.dataset.mode;
                        this.resetTraining();
                        this.setupMode();
                    });
                });

                // æ§åˆ¶æŒ‰é’®
                this.startBtn.addEventListener('click', () => this.startTraining());
                this.switchBtn.addEventListener('click', () => this.switchToWhite());
                this.stopBtn.addEventListener('click', () => this.stopTraining());
                this.nextBtn.addEventListener('click', () => this.nextItem());
                this.logBtn.addEventListener('click', () => this.showTrainingLog());

                // é¢œè‰²é€‰æ‹©å™¨
                document.querySelectorAll('.color-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.color-option').forEach(o => o.classList.remove('active'));
                        e.target.classList.add('active');
                        this.setupColorCard(e.target.dataset.color);
                    });
                });

                // å½¢çŠ¶é€‰æ‹©å™¨
                document.querySelectorAll('.shape-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.shape-option').forEach(o => o.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentShape = e.target.dataset.shape;
                        this.setupShapeCard(this.currentShape);
                    });
                });

                // æ¨¡æ€æ¡†äº‹ä»¶
                this.closeModal.addEventListener('click', () => this.hideTrainingLog());
                this.clearLogBtn.addEventListener('click', () => this.clearTrainingLog());
                
                // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
                window.addEventListener('click', (e) => {
                    if (e.target === this.logModal) {
                        this.hideTrainingLog();
                    }
                });
            }

            setupMode() {
                this.colorSelector.style.display = 'none';
                this.shapeSelector.style.display = 'none';
                this.nextBtn.style.display = 'none';

                switch(this.currentMode) {
                    case 'yellow':
                        this.setupYellowCard();
                        break;
                    case 'color':
                        this.colorSelector.style.display = 'flex';
                        this.nextBtn.style.display = 'inline-block';
                        document.querySelector('.color-option').classList.add('active');
                        this.setupColorCard('red');
                        this.currentColorIndex = 0;
                        break;
                    case 'shape':
                        this.shapeSelector.style.display = 'flex';
                        this.setupShapeCard('circle');
                        break;
                }
                this.updateInstructions();
            }

            setupYellowCard() {
                this.trainingCard.className = 'training-card yellow-card';
                this.trainingCard.innerHTML = '';
            }

            setupColorCard(color) {
                this.trainingCard.className = `training-card color-${color}`;
                this.trainingCard.innerHTML = '';
            }

            setupShapeCard(shape) {
                this.trainingCard.className = 'training-card shape-card';
                let shapeElement = '';
                switch(shape) {
                    case 'circle':
                        shapeElement = '<div class="circle"></div>';
                        break;
                    case 'triangle':
                        shapeElement = '<div class="triangle"></div>';
                        break;
                    case 'diamond':
                        shapeElement = '<div class="diamond"></div>';
                        break;
                }
                this.trainingCard.innerHTML = shapeElement;
            }

            startTraining() {
                // è®©è®­ç»ƒå¡ç‰‡å¡«æ»¡è®­ç»ƒåŒºåŸŸ
                this.trainingCard.classList.add('training-active');
                
                if (!this.isTraining) {
                    // ç¬¬ä¸€æ¬¡å¼€å§‹è®­ç»ƒ
                    this.isTraining = true;
                    this.autoTraining = true;
                    this.sessionStartTime = new Date();
                }
                
                this.totalTime = parseInt(this.durationInput.value, 10);
                this.timeLeft = this.totalTime;
                this.startBtn.disabled = true;
                this.switchBtn.disabled = false;
                this.stopBtn.disabled = false;
                
                this.updateTimer();
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    this.updateTimer();
                    
                    if (this.timeLeft <= 0) {
                        this.completeTraining();
                    }
                }, 1000);
            }

            completeTraining() {
                clearInterval(this.timer);
                this.timerDisplay.textContent = 'å‡è§†å®Œæˆï¼è‡ªåŠ¨åˆ‡æ¢åˆ°ç™½çº¸...';
                this.timerDisplay.style.color = '#48bb78';
                this.progressFill.style.width = '100%';
                
                // 1ç§’åè‡ªåŠ¨åˆ‡æ¢åˆ°ç™½çº¸
                setTimeout(() => {
                    if (this.isTraining) {
                        this.autoSwitchToWhite();
                    }
                }, 1000);
            }

            autoSwitchToWhite() {
                this.trainingCard.className = 'training-card white-background';
                this.trainingCard.innerHTML = '';
                this.timerDisplay.textContent = 'è§‚å¯Ÿç™½çº¸ä¸Šçš„æ®‹åƒ...';
                this.timerDisplay.style.color = '#667eea';
                this.switchBtn.disabled = true;
                
                // å¼€å§‹ç™½çº¸é˜¶æ®µçš„30ç§’è®¡æ—¶
                this.timeLeft = this.totalTime;
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    this.updateWhiteTimer();
                    
                    if (this.timeLeft <= 0) {
                        this.completeWhitePhase();
                    }
                }, 1000);
            }

            updateWhiteTimer() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                this.timerDisplay.textContent = `è§‚å¯Ÿæ®‹åƒä¸­... ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = ((this.totalTime - this.timeLeft) / this.totalTime) * 100;
                this.progressFill.style.width = `${progress}%`;
                
                // æœ€å10ç§’å˜è‰²æé†’
                if (this.timeLeft <= 10 && this.timeLeft > 0) {
                    this.timerDisplay.style.color = '#f56565';
                } else {
                    this.timerDisplay.style.color = '#667eea';
                }
            }

            completeWhitePhase() {
                clearInterval(this.timer);
                this.currentRound++;
                this.updateRoundDisplay();
                
                // è®°å½•æœ¬è½®è®­ç»ƒ
                this.recordTrainingRound();
                
                this.timerDisplay.textContent = `ç¬¬${this.currentRound}è½®å®Œæˆï¼3ç§’åè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®...`;
                this.timerDisplay.style.color = '#48bb78';
                this.progressFill.style.width = '100%';
                
                // 3ç§’åè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®è®­ç»ƒ
                setTimeout(() => {
                    if (this.isTraining) {
                        this.autoStartNextRound();
                    }
                }, 3000);
            }

            autoStartNextRound() {
                // è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®è®­ç»ƒ
                this.timerDisplay.textContent = 'è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®è®­ç»ƒ...';
                this.progressFill.style.width = '0%';
                this.setupMode(); // é‡æ–°è®¾ç½®å¡ç‰‡
                
                setTimeout(() => {
                    if (this.isTraining) {
                        this.startTraining();
                    }
                }, 1000);
            }

            switchToWhite() {
                // æ‰‹åŠ¨åˆ‡æ¢åˆ°ç™½çº¸ï¼ˆä¿ç•™åŸæœ‰åŠŸèƒ½ï¼‰
                this.trainingCard.className = 'training-card white-background';
                this.trainingCard.innerHTML = '';
                this.timerDisplay.textContent = 'è§‚å¯Ÿç™½çº¸ä¸Šçš„æ®‹åƒï¼Œå°½é‡ä¿æŒä¸“æ³¨';
                this.timerDisplay.style.color = '#667eea';
                this.switchBtn.disabled = true;
                
                // 60ç§’åæç¤º
                setTimeout(() => {
                    if (this.isTraining) {
                        this.timerDisplay.textContent = 'å¾ˆå¥½ï¼å¯ä»¥åœæ­¢è®­ç»ƒæˆ–ç»§ç»­ä¸‹ä¸€è½®';
                    }
                }, 60000);
            }

            stopTraining() {
                // ç§»é™¤è®­ç»ƒæ—¶çš„æ‰©å±•æ ·å¼
                this.trainingCard.classList.remove('training-active');

                // åœæ­¢è®­ç»ƒå¹¶ä¿å­˜è®­ç»ƒè®°å½•
                if (this.isTraining && this.sessionStartTime) {
                    this.saveTrainingSession();
                }
                
                this.resetTraining();
                this.setupMode();
            }

            resetTraining() {
                this.isTraining = false;
                this.autoTraining = false;
                
                // ç§»é™¤è®­ç»ƒæ—¶çš„æ‰©å±•æ ·å¼
                this.trainingCard.classList.remove('training-active');
                
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
                
                // é‡ç½®è½®æ¬¡å’Œä¼šè¯æ—¶é—´
                this.currentRound = 0;
                this.sessionStartTime = null;
                this.sessionTime = 0;
                
                this.startBtn.disabled = false;
                this.switchBtn.disabled = true;
                this.stopBtn.disabled = true;
                
                this.timerDisplay.textContent = 'å‡†å¤‡å¼€å§‹è®­ç»ƒ';
                this.timerDisplay.style.color = '#4c51bf';
                this.progressFill.style.width = '0%';
                
                // æ›´æ–°æ˜¾ç¤º
                this.updateRoundDisplay();
                this.updateSessionTimeDisplay();
            }

            nextItem() {
                if (this.currentMode === 'color') {
                    this.currentColorIndex = (this.currentColorIndex + 1) % this.colors.length;
                    const nextColor = this.colors[this.currentColorIndex];
                    
                    // æ›´æ–°é¢œè‰²é€‰æ‹©å™¨
                    document.querySelectorAll('.color-option').forEach(o => o.classList.remove('active'));
                    document.querySelector(`[data-color="${nextColor}"]`).classList.add('active');
                    
                    this.setupColorCard(nextColor);
                    this.resetTraining();
                }
            }

            updateTimer() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                this.timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = ((this.totalTime - this.timeLeft) / this.totalTime) * 100;
                this.progressFill.style.width = `${progress}%`;
                
                // æœ€å10ç§’å˜è‰²æé†’
                if (this.timeLeft <= 10 && this.timeLeft > 0) {
                    this.timerDisplay.style.color = '#f56565';
                } else {
                    this.timerDisplay.style.color = '#4c51bf';
                }
            }

            updateInstructions() {
                const instructions = {
                    'yellow': {
                        title: 'ğŸ¯ é»„å¡è®­ç»ƒè¯´æ˜',
                        steps: [
                            '1. åœ¨ä¸Šæ–¹è®¾ç½®å¥½æ¯é˜¶æ®µæ—¶é•¿åï¼Œç‚¹å‡»"å¼€å§‹è®­ç»ƒ"æŒ‰é’®',
                            '2. æ¯è½®è®­ç»ƒï¼šå‡è§†é»„å¡ã€è®¾å®šæ—¶é•¿ã€‘ â†’ è‡ªåŠ¨åˆ‡æ¢ç™½çº¸ã€è®¾å®šæ—¶é•¿ã€‘ â†’ è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€è½®',
                            '3. è®­ç»ƒè¿‡ç¨‹ä¸­å°½é‡ä¸è¦çœ¨çœ¼ï¼Œä¿æŒæ³¨æ„åŠ›é›†ä¸­',
                            '4. åˆæœŸçœ‹åˆ°çš„æ®‹åƒæ˜¯è¡¥è‰²ï¼ˆè“åº•é»„ç‚¹ï¼‰ï¼Œéšç€è®­ç»ƒè¿›æ­¥ä¼šçœ‹åˆ°åŸè‰²',
                            '5. ç¨‹åºä¼šè‡ªåŠ¨è®°å½•è®­ç»ƒæ—¶é—´å’Œè½®æ¬¡ï¼Œå¯ç‚¹å‡»"åœæ­¢è®­ç»ƒ"ç»“æŸå¹¶ä¿å­˜è®°å½•'
                        ]
                    },
                    'color': {
                        title: 'ğŸŒˆ å½©è™¹é¢œè‰²è®­ç»ƒè¯´æ˜',
                        steps: [
                            '1. è®¾ç½®æ—¶é•¿ï¼Œé€‰æ‹©é¢œè‰²åç‚¹å‡»"å¼€å§‹è®­ç»ƒ"ï¼Œç¨‹åºè‡ªåŠ¨è¿ç»­è®­ç»ƒ',
                            '2. æ¯è½®ï¼šå‡è§†å½©è‰²åœ†å½¢ã€è®¾å®šæ—¶é•¿ã€‘ â†’ è‡ªåŠ¨åˆ‡æ¢ç™½çº¸è§‚å¯Ÿæ®‹åƒã€è®¾å®šæ—¶é•¿ã€‘',
                            '3. è®­ç»ƒä¼šè‡ªåŠ¨å¾ªç¯è¿›è¡Œï¼Œæ³¨æ„è§‚å¯Ÿæ®‹åƒçš„è¡¥è‰²æ•ˆæœ',
                            '4. å¯éšæ—¶ç‚¹å‡»"ä¸‹ä¸€ä¸ª"åˆ‡æ¢åˆ°å…¶ä»–é¢œè‰²ç»§ç»­è®­ç»ƒ',
                            '5. ç›®æ ‡æ˜¯èƒ½çœ‹åˆ°åŸæœ¬çš„é¢œè‰²è€Œéè¡¥è‰²'
                        ]
                    },
                    'shape': {
                        title: 'ğŸ“ å½¢çŠ¶è®­ç»ƒè¯´æ˜',
                        steps: [
                            '1. è®¾ç½®æ—¶é•¿ï¼Œé€‰æ‹©å½¢çŠ¶åç‚¹å‡»"å¼€å§‹è®­ç»ƒ"ï¼Œç¨‹åºå°†è‡ªåŠ¨è¿ç»­è¿›è¡Œ',
                            '2. æ¯è½®ï¼šå‡è§†å½¢çŠ¶ã€è®¾å®šæ—¶é•¿ã€‘ â†’ è‡ªåŠ¨åˆ‡æ¢ç™½çº¸è§‚å¯Ÿæ®‹åƒã€è®¾å®šæ—¶é•¿ã€‘',
                            '3. ä¸“æ³¨äºé»‘è‰²è½®å»“è¾¹ç¼˜ï¼Œè§‚å¯Ÿçº¿æ¡å˜ç™½ã€å›¾å½¢æµ®èµ·çš„æ•ˆæœ',
                            '4. è®­ç»ƒä¼šè‡ªåŠ¨å¾ªç¯ï¼Œå¯éšæ—¶åˆ‡æ¢ä¸åŒå½¢çŠ¶',
                            '5. ç†Ÿç»ƒåå»ºè®®ç”¨ç”Ÿæ´»ä¸­çš„å…·ä½“ç‰©å“ç»ƒä¹ '
                        ]
                    }
                };

                const current = instructions[this.currentMode];
                this.instructions.innerHTML = `
                    <h3>${current.title}</h3>
                    <ul>
                        ${current.steps.map(step => `<li>${step}</li>`).join('')}
                    </ul>
                `;
            }

            loadTrainingStats() {
                this.updateTotalTimeDisplay();
            }

            startSessionTimer() {
                // æ¯ç§’æ›´æ–°ä¼šè¯æ—¶é—´æ˜¾ç¤º
                this.sessionTimer = setInterval(() => {
                    if (this.isTraining && this.sessionStartTime) {
                        const now = new Date();
                        this.sessionTime = Math.floor((now - this.sessionStartTime) / 1000);
                        this.updateSessionTimeDisplay();
                    }
                }, 1000);
            }

            updateRoundDisplay() {
                this.currentRoundDisplay.textContent = this.currentRound;
            }

            updateSessionTimeDisplay() {
                const minutes = Math.floor(this.sessionTime / 60);
                const seconds = this.sessionTime % 60;
                this.sessionTimeDisplay.textContent = `${minutes}åˆ†${seconds}ç§’`;
            }

            updateTotalTimeDisplay() {
                const totalSeconds = parseInt(localStorage.getItem('totalTrainingTime') || '0');
                const totalMinutes = Math.floor(totalSeconds / 60);
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                
                if (hours > 0) {
                    this.totalTimeDisplay.textContent = `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
                } else {
                    this.totalTimeDisplay.textContent = `${totalMinutes}åˆ†é’Ÿ`;
                }
            }

            showTrainingLog() {
                const trainingHistory = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
                
                if (trainingHistory.length === 0) {
                    this.logContent.innerHTML = '<p style="text-align: center; color: #718096;">æš‚æ— è®­ç»ƒè®°å½•</p>';
                } else {
                    let logHtml = '';
                    trainingHistory.forEach(session => {
                        const duration = this.formatDuration(session.duration);
                        logHtml += `
                            <div class="log-entry">
                                <div class="log-date">${session.date} ${session.startTime} - ${session.endTime}</div>
                                <div class="log-details">
                                    è®­ç»ƒæ¨¡å¼: ${session.modeText} | 
                                    å®Œæˆè½®æ¬¡: ${session.rounds}è½® | 
                                    è®­ç»ƒæ—¶é•¿: ${duration}
                                </div>
                            </div>
                        `;
                    });
                    this.logContent.innerHTML = logHtml;
                }
                
                this.logModal.style.display = 'block';
            }

            hideTrainingLog() {
                this.logModal.style.display = 'none';
            }

            clearTrainingLog() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®­ç»ƒè®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    localStorage.removeItem('trainingHistory');
                    localStorage.removeItem('totalTrainingTime');
                    this.updateTotalTimeDisplay();
                    this.showTrainingLog(); // åˆ·æ–°æ˜¾ç¤º
                }
            }

            formatDuration(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                
                if (hours > 0) {
                    return `${hours}å°æ—¶${minutes}åˆ†${secs}ç§’`;
                } else if (minutes > 0) {
                    return `${minutes}åˆ†${secs}ç§’`;
                } else {
                    return `${secs}ç§’`;
                }
            }

            recordTrainingRound() {
                // è®°å½•å•è½®è®­ç»ƒæ•°æ®ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼Œä¸ä¿å­˜åˆ°localStorageï¼‰
                const roundData = {
                    round: this.currentRound,
                    mode: this.currentMode,
                    timestamp: new Date().toISOString()
                };
                // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šè½®æ¬¡ç»Ÿè®¡é€»è¾‘
            }

            saveTrainingSession() {
                if (!this.sessionStartTime) return;
                
                const sessionEnd = new Date();
                const sessionDuration = Math.floor((sessionEnd - this.sessionStartTime) / 1000); // ç§’
                
                const sessionData = {
                    date: this.sessionStartTime.toISOString().split('T')[0],
                    startTime: this.sessionStartTime.toLocaleTimeString(),
                    endTime: sessionEnd.toLocaleTimeString(),
                    duration: sessionDuration,
                    rounds: this.currentRound,
                    mode: this.currentMode,
                    modeText: this.getModeText()
                };
                
                // ä¿å­˜åˆ°localStorage
                let trainingHistory = JSON.parse(localStorage.getItem('trainingHistory') || '[]');
                trainingHistory.unshift(sessionData); // æœ€æ–°çš„è®°å½•æ”¾åœ¨å‰é¢
                
                // åªä¿ç•™æœ€è¿‘100æ¡è®°å½•
                if (trainingHistory.length > 100) {
                    trainingHistory = trainingHistory.slice(0, 100);
                }
                
                localStorage.setItem('trainingHistory', JSON.stringify(trainingHistory));
                
                // æ›´æ–°ç´¯è®¡æ—¶é—´
                let totalTrainingTime = parseInt(localStorage.getItem('totalTrainingTime') || '0');
                totalTrainingTime += sessionDuration;
                localStorage.setItem('totalTrainingTime', totalTrainingTime.toString());
                
                this.updateTotalTimeDisplay();
            }

            getModeText() {
                const modeTexts = {
                    'yellow': 'é»„å¡è®­ç»ƒ',
                    'color': 'å½©è™¹é¢œè‰²è®­ç»ƒ',
                    'shape': 'å½¢çŠ¶è®­ç»ƒ'
                };
                return modeTexts[this.currentMode] || 'æœªçŸ¥è®­ç»ƒ';
            }
        }

        class PomodoroClock {
            constructor() {
                this.focusTime = 25 * 60; // 25 minutes
                this.breakTime = 5 * 60; // 5 minutes
                this.currentTime = this.focusTime;
                this.isPaused = true;
                this.isFocusMode = true;
                this.timerInterval = null;

                this.timeDisplay = document.getElementById('pomodoroTime');
                this.statusDisplay = document.getElementById('pomodoroStatus');
                this.startPauseBtn = document.getElementById('pomodoroStartPause');
                this.resetBtn = document.getElementById('pomodoroReset');

                this.bindEvents();
                this.updateDisplay();
            }

            bindEvents() {
                this.startPauseBtn.addEventListener('click', () => this.toggleTimer());
                this.resetBtn.addEventListener('click', () => this.resetTimer());
            }

            toggleTimer() {
                this.isPaused = !this.isPaused;
                if (this.isPaused) {
                    clearInterval(this.timerInterval);
                    this.startPauseBtn.textContent = 'ç»§ç»­';
                } else {
                    this.startPauseBtn.textContent = 'æš‚åœ';
                    this.timerInterval = setInterval(() => this.tick(), 1000);
                }
            }

            tick() {
                if (this.currentTime > 0) {
                    this.currentTime--;
                    this.updateDisplay();
                } else {
                    this.switchMode();
                }
            }

            switchMode() {
                clearInterval(this.timerInterval);
                this.isPaused = true;
                this.isFocusMode = !this.isFocusMode;

                if (this.isFocusMode) {
                    alert('ä¼‘æ¯ç»“æŸï¼å‡†å¤‡å¼€å§‹ä¸‹ä¸€ä¸ªä¸“æ³¨æ—¶æ®µã€‚');
                    this.currentTime = this.focusTime;
                    this.statusDisplay.textContent = 'ä¸“æ³¨';
                    this.statusDisplay.classList.remove('break-mode');
                } else {
                    alert('ä¸“æ³¨æ—¶æ®µç»“æŸï¼ä¼‘æ¯ä¸€ä¸‹å§ã€‚');
                    this.currentTime = this.breakTime;
                    this.statusDisplay.textContent = 'ä¼‘æ¯';
                    this.statusDisplay.classList.add('break-mode');
                }
                
                this.startPauseBtn.textContent = 'å¼€å§‹';
                this.updateDisplay();
            }

            resetTimer() {
                clearInterval(this.timerInterval);
                this.isPaused = true;
                this.isFocusMode = true;
                this.currentTime = this.focusTime;
                this.updateDisplay();
                this.startPauseBtn.textContent = 'å¼€å§‹';
                this.statusDisplay.textContent = 'ä¸“æ³¨';
                this.statusDisplay.classList.remove('break-mode');
            }

            updateDisplay() {
                const minutes = Math.floor(this.currentTime / 60);
                const seconds = this.currentTime % 60;
                this.timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // åˆå§‹åŒ–è®­ç»ƒå™¨
        document.addEventListener('DOMContentLoaded', () => {
            new AfterimageTrainer();
            new PomodoroClock();
        });
    </script>
</body>
</html> 